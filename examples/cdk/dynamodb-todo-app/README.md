# Todo API - CDK Example

This CDK app provides an implementation for a simple Todo API  with AppSync JavaScript resolvers.

The API allows you to interact with a Todo type that is backed by a DynamoDB table.

```graphql
type Todo {
  id: ID!
  title: String
  description: String
  owner: String
}
```

The app uses the [AppSync Helper construct](../constructs/appsync-helper/) for a quick setup.

```sh
lib
├── appsync
│   ├── codegen
│   │   └── index.ts
│   ├── resolvers
│   │   ├── Mutation.createTodo.[todos].ts
│   │   ├── Mutation.deleteTodo.[todos].ts
│   │   ├── Mutation.updateTodo.[todos].ts
│   │   ├── Query.getTodo.[todos].ts
│   │   ├── Query.listTodos.[todos].ts
│   │   └── utils.ts
│   └── schema.graphql
├── appsync-helper.ts
└── dynamodb-todo-app-stack.ts
```

The [appsync](./lib/appsync) folder contains schema and the resolver code. This project uses unit resolvers, but you can expand it to use pipeline resolvers if needed.

## Pre-req

Build the `appsync-helper`. See the [README](../constructs/appsync-helper/README.md#init).

## Init

Install all the dependencies. From the [project folder](./)

```sh
npm install
```

## Codegen

This TypeScript projects uses types generated by [Amplify Codegen](https://docs.amplify.aws/cli-legacy/graphql-transformer/codegen/). To populate your codegen and generate it after you update your schema, run the command:

```sh
npm run codegen
```

## Deploy the stack

To deploy the stack, from the top folder:

```sh
npm run cdk deploy -- -O output.json
```

Once deployed, you can find your API **TodoAPI** in the AWS console.

## Test the API

From the "Queries Editor" in the AWS console, create a new todo:

```graphql
mutation NewTodo {
  createTodo(input: {description: "Hello World!", 
  owner: "<your name>", 
  title: "my first task"}) {
    description
    id
    owner
    title
  }
}
```

Copy the `id` that's returned. You can now update your todo:

```graphql
mutation NewTodo {
  updateTodo(input: {id: "<id>", description: "Bonjour!"}) {
    description
    id
    owner
    title
  }
}
```

If you try to update an item that does not exist, you get an error message. You can now get, list, and even subscribe to todos!

## Connect to an app

You can use the info in [./output.json](./output.json) to configure your Amplify client in your app. See [Building a client application](https://docs.aws.amazon.com/appsync/latest/devguide/building-a-client-app.html).

## Destroy the stack

To destroy the stack and all the created resources:

```sh
npm run cdk destroy
```
